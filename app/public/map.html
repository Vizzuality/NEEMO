<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/map.css" />
    <script src="https://www.google.com/jsapi"></script>
    <script>google.load("jquery", "1.6.2");</script>
    <script src="/socket.io/socket.io.js"></script>
          <script src="/js/libs/jquery-ui-1.8.16.custom.min.js"></script>
          <script src="/js/libs/raphael-min.js"></script>
          <script src="/js/libs/underscore-min.js"></script>
          <script src="/js/libs/backbone-min.js"></script>
          <script src="/js/libs/class.js"></script>
          <script src="/js/libs/plugins.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
</script>
<script type="text/javascript">
    var map;
    var getNormalizedCoord = function(coord, zoom) {
                var y = coord.y,
                    x = coord.x,
                    tileRange = 1 << zoom;
                // don't repeat across y-axis (vertically)
                if (y < 0 || y >= tileRange) {
                    return null;
                }
                // repeat across x-axis
                if (x < 0 || x >= tileRange) {
                    x = (x % tileRange + tileRange) % tileRange;
                }
                return {
                    x: x,
                    y: y
                };
            };
    $(document).ready(function() {
        var latlng = new google.maps.LatLng(24.9469983333, -80.4559166667);

        var mapOptions = {
          zoom: 16,
          center: latlng,
		  //position: google.maps.ControlPosition.BOTTOM_LEFT,
          mapTypeId: google.maps.MapTypeId.SATELLITE
        };
        map = new google.maps.Map($('.map_window')[0], mapOptions);

		var barrels  = new google.maps.ImageMapType(
                    {
                        getTileUrl: function(coord, zoom) {
                            var normalizedCoord = getNormalizedCoord(coord, zoom),
                                bound = Math.pow(2, zoom),
								tileurl = "https://andrew.cartodb.com/tiles/neemo_regions/"+zoom+"/"+coord.x+"/"+coord.y+".png?map_key=6147435ec8bfdbf9ad547d041e460b23167e956a&sql=SELECT neemo_regions.the_geom_webmercator, neemo_regions.region, neemo.category, count(*) FROM neemo_regions, neemo WHERE neemo_regions.region = neemo.region GROUP BY neemo.category, neemo_regions.region, neemo_regions.the_geom_webmercator";
                            return tileurl;
                        },
                        tileSize: new google.maps.Size(256, 256),
                        isPng: true, 
						name: 'barrels'
                    });
        map.overlayMapTypes.push(barrels);
    });

</script>
</head>
<body>
  <div class="map_window" style="width:100%; height:100%"></div>
  <div id="legend">
	<ul> 
		<li class="coral"><span class="icon"></span>coral</li>
	    <li class="barrel"><span class="icon"></span>barrel</li> 
		<li class="gorgonian"><span class="icon"></span>gorg.</li> 
		<li class="other"><span class="icon"></span>other</li>
	</ul>
  </div>

<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ea02b69613f5d77bb000004');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</body>
</html>
